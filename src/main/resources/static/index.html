<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deployment Status</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:#1f2937; /* Dark Gray-Blue Background */
      color:#f3f4f6;
      min-height:100vh;
      padding:20px;
    }

    .container { max-width:1200px; margin:0 auto; }
    .header { text-align:center; margin-bottom:40px; }
    .header h1 {
      font-size:2.3rem;
      font-weight:700;
      margin-bottom:10px;
      color:#f9fafb;
    }
    .header p { font-size:1.1rem; color:#d1d5db; }

    .dashboard {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
      gap:25px;
      margin-bottom:40px;
    }

    .card {
      background:#ffffff;
      border-radius:12px;
      padding:25px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
      border:1px solid #e0e0e0;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      color:#111827;
    }
    .card:hover {
      transform: translateY(-3px);
      box-shadow:0 6px 18px rgba(0,0,0,0.15);
    }

    .card-header {
      display:flex;
      align-items:center;
      margin-bottom:20px;
    }
    .card-icon {
      width:48px;
      height:48px;
      border-radius:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      margin-right:15px;
      font-size:20px;
      color:#fff;
    }
    .success { background:#22c55e; }
    .warning { background:#f59e0b; }
    .info { background:#3b82f6; }
    .danger { background:#ef4444; }

    .card h3 { font-size:1.2rem; font-weight:600; color:#111827; }
    .status-value {
      font-size:1.6rem;
      font-weight:700;
      margin:12px 0;
    }
    .status-description {
      color:#4b5563;
      font-size:0.9rem;
      line-height:1.5;
    }

    .metrics {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
      gap:15px;
      margin-top:15px;
    }
    .metric {
      text-align:center;
      padding:12px;
      background:#f9fafb;
      border-radius:8px;
      border:1px solid #e5e7eb;
    }
    .metric-value {
      font-size:1.3rem;
      font-weight:700;
      color:#111827;
    }
    .metric-label {
      font-size:0.8rem;
      color:#6b7280;
      margin-top:4px;
    }

    .logs {
      background:#ffffff;
      border-radius:12px;
      padding:25px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
      border:1px solid #e0e0e0;
      color:#111827;
    }
    .logs h3 {
      margin-bottom:15px;
      display:flex;
      align-items:center;
      font-size:1.2rem;
      color:#111827;
    }
    .logs h3 i { margin-right:8px; color:#3b82f6; }
    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      background:#f9fafb;
      padding:15px;
      border-radius:8px;
      border:1px solid #e5e7eb;
      max-height:400px;
      overflow:auto;
      font-size:0.85rem;
      color:#111827;
    }

    .logout-btn {
      position:fixed;
      top:20px;
      right:20px;
      background:#2563eb;
      color:white;
      border:none;
      padding:12px 20px;
      border-radius:25px;
      cursor:pointer;
      font-weight:600;
      transition: all 0.3s ease;
    }
    .logout-btn:hover {
      background:#1e40af;
      transform:translateY(-2px);
    }

    @media (max-width:768px) {
      .header h1 { font-size:2rem; }
      .dashboard { grid-template-columns:1fr; }
      .logout-btn { position:relative; width:100%; margin-bottom:20px; }
    }

    .pulse { animation:pulse 2s infinite; }
    @keyframes pulse {
      0% { opacity:1; }
      50% { opacity:0.6; }
      100% { opacity:1; }
    }
  </style>
</head>
<body>
  <button class="logout-btn" onclick="location.href='/logout'">
    <i class="fas fa-sign-out-alt"></i> Logout
  </button>

  <div class="container">
    <div class="header">
      <h1>Deployment Successful!</h1>
      <p>DevOps Project Status Dashboard</p>
    </div>

    <div class="dashboard">
      <div class="card">
        <div class="card-header">
          <div class="card-icon success"><i class="fas fa-server"></i></div>
          <h3>Spring Boot Application</h3>
        </div>
        <div class="status-value success pulse">RUNNING</div>
        <div class="status-description">Application is healthy and processing requests successfully.</div>
        <div class="metrics">
          <div class="metric"><div class="metric-value">99.9%</div><div class="metric-label">Uptime</div></div>
          <div class="metric"><div class="metric-value">8081</div><div class="metric-label">Port</div></div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-icon info"><i class="fas fa-database"></i></div>
          <h3>System Health</h3>
        </div>
        <div class="status-value info">HEALTHY</div>
        <div class="status-description">All system components are functioning normally.</div>
        <div class="metrics">
          <div class="metric"><div class="metric-value">45%</div><div class="metric-label">CPU</div></div>
          <div class="metric"><div class="metric-value">1.2GB</div><div class="metric-label">Memory</div></div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-icon success"><i class="fas fa-cloud"></i></div>
          <h3>Deployment Status</h3>
        </div>
        <div class="status-value success" id="deployStatus">DEPLOYED</div>
        <div class="status-description">Latest version successfully deployed and active.</div>
        <div class="metrics">
          <div class="metric"><div class="metric-value" id="deployVersion">v1.0</div><div class="metric-label">Version</div></div>
          <div class="metric"><div class="metric-value" id="deployTime">2min</div><div class="metric-label">Deploy Time</div></div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-icon warning"><i class="fas fa-cogs"></i></div>
          <h3>CI/CD Pipeline</h3>
        </div>
        <div class="status-value warning">MONITORING</div>
        <div class="status-description">Continuous integration pipeline is actively monitoring for changes.</div>
        <div class="metrics">
          <div class="metric"><div class="metric-value">Jenkins</div><div class="metric-label">Tool</div></div>
          <div class="metric"><div class="metric-value">8080</div><div class="metric-label">Port</div></div>
        </div>
      </div>
    </div>

    <div class="logs">
      <h3><i class="fas fa-list"></i> Recent Deployment Logs</h3>
      <pre id="jenkinsLogs"></pre>
    </div>
  </div>

  <script>
    const JOB_NAME = ""; // leave empty to use backend default job
    const REFRESH_MS = 8000;

    function lastNLines(text, n) {
      const arr = text.split("\n");
      const start = arr.length - n;
      return arr.slice(start > 0 ? start : 0).join("\n");
    }

    async function loadJenkinsStatus() {
      try {
        let url = "/api/jenkins/status";
        if (JOB_NAME) url += "?job=" + encodeURIComponent(JOB_NAME);
        const resp = await fetch(url);
        if (!resp.ok) return;
        const status = await resp.json();
        const statusEl = document.getElementById("deployStatus");
        if (statusEl) statusEl.textContent = status.building ? "BUILDING" : (status.result || "UNKNOWN");
        const verEl = document.getElementById("deployVersion");
        if (verEl && status.number) verEl.textContent = "v" + status.number;
        const timeEl = document.getElementById("deployTime");
        if (timeEl && status.timestamp) timeEl.textContent = new Date(status.timestamp).toLocaleString();
      } catch(e) {}
    }

    async function loadJenkinsLogs() {
      try {
        let url = "/api/jenkins/console";
        if (JOB_NAME) url += "?job=" + encodeURIComponent(JOB_NAME);
        const resp = await fetch(url);
        if (!resp.ok) return;
        const text = await resp.text();
        const logsEl = document.getElementById("jenkinsLogs");
        if (logsEl) {
          logsEl.textContent = lastNLines(text, 300);
          logsEl.scrollTop = logsEl.scrollHeight;
        }
      } catch(e) {}
    }

    function startAutoRefresh() {
      loadJenkinsStatus();
      loadJenkinsLogs();
      setInterval(loadJenkinsStatus, REFRESH_MS);
      setInterval(loadJenkinsLogs, REFRESH_MS);
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", startAutoRefresh);
    } else { startAutoRefresh(); }
  </script>
</body>
</html>
